@{
    ViewData["Title"] = "Analysis";
}

<h1>Analysis</h1>

<div id="shipmentPieChart" style="width: 900px; height: 500px;"></div>
<div id="carrierPieChart" style="width: 900px; height: 500px;"></div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {
        packages: ['corechart']
    });
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
        // Draw the shipment status pie chart
        fetch('@Url.Action("GetShipmentStatusData", "Shipments")')
            .then(response => response.json())
            .then(data => {
                var statusData = [['Status', 'Count']];

                // Populate status chart data
                data.forEach(item => {
                    statusData.push([item.status, item.count]);
                });

                var statusOptions = {
                    title: 'Shipment Status Distribution',
                    pieHole: 0.4,
                };

                var statusChart = new google.visualization.PieChart(document.getElementById('shipmentPieChart'));
                statusChart.draw(google.visualization.arrayToDataTable(statusData), statusOptions);
            })
            .catch(error => console.error('Error fetching shipment status data:', error));

        // Draw the carrier pie chart
        fetch('@Url.Action("GetCarrierData", "Shipments")')
            .then(response => response.json())
            .then(data => {
                var carrierData = [['Carrier', 'Count']];

                // Populate carrier chart data
                data.forEach(item => {
                    carrierData.push([item.carrier, item.count]);
                });

                var carrierOptions = {
                    title: 'Shipments by Carrier',
                    pieHole: 0.4,
                };

                var carrierChart = new google.visualization.PieChart(document.getElementById('carrierPieChart'));
                carrierChart.draw(google.visualization.arrayToDataTable(carrierData), carrierOptions);
            })
            .catch(error => console.error('Error fetching carrier data:', error));
    }
</script>
